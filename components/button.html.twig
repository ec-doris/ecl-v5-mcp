{% import _self as button %}
{% apply spaceless %}

{#
  Parameters:
    - "label" (string) (default: '')
    - "size" (string) (default: 'l'): button size
    - "variant" (string) (default: 'primary'): can be 'primary', 'secondary', 'tertiary'
    - "style" (string) (default: ''): can be 'highlight', 'neutral', 'inverted'. Not all styles are available for all variants
    - "type" (string) (default: 'submit'): can be the same type as HTML button - 'submit', 'reset', 'button'
    - "icon" (associative array) OR (array) of associative arrays : format
        {
          name: (string) (default: ''),
          ...
        }
        OR
        [
          {
            name: (string) (default: ''),
            ....
          },
          {
            name: (string) (default: ''),
            ...
          }
          ...
        ]
    - "disabled" (bool) (default: false): defined if button should be active or not (HTML disabled attribute)
    - "hide_label" (bool) (default: false): hide button label, for screen reader only. Note: requires to have an icon defined
    - "icon_position" (string) (default: after): define icon position, can be 'before' or 'after'
    - "indicator" (object) (default: {}) object of type Indicator. To be displayed it should be defined and not empty (should contain at least an empty value), and only if there is an icon and no label
    - "extra_classes" (string) (default: '')
    - "extra_attributes" (array) (default: []): format: [
        {
          "name" (string) (default: ''),
          "value" (optional) (string)
        ...
      ],
  Blocks:
    - "label"
#}

{# Internal properties #}

{% set _css_class = 'ecl-button' %}
{% set _extra_attributes = '' %}
{% set _label = label|default('') %}
{% set _size = size|default('l') %}
{% set _variant = variant|default('primary') %}
{% set _style = style|default('') %}
{% set _type = type|default('submit') %}
{% set _icon_position = icon_position|default('after') %}
{% set _disabled = disabled|default(false) %}
{% set _hide_label = hide_label|default(false) %}
{% set _icon = icon|default({
  name: '',
  size: '',
  title: ''
}) %}
{% set _indicator = indicator|default({}) %}

{# Internal logic - Process properties #}

{% set _css_class = _css_class ~ ' ecl-button--' ~ _variant %}

{% if _size != 'l' %}
  {% set _css_class = _css_class ~ ' ecl-button--' ~ _size %}
{% endif %}

{% if _style is not empty %}
  {% set _css_class = _css_class ~ ' ecl-button--' ~ _style %}
{% endif %}

{% if extra_classes is defined and extra_classes is not empty %}
  {% set _css_class = _css_class ~ ' ' ~ extra_classes %}
{% endif %}

{% if extra_attributes is defined and extra_attributes is not empty and extra_attributes is iterable %}
  {% for attr in extra_attributes %}
    {% if attr.value is defined %}
      {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name|e('html_attr') ~ '="' ~ attr.value|e('html_attr') ~ '"' %}
    {% else %}
      {% set _extra_attributes = _extra_attributes ~ ' ' ~ attr.name|e('html_attr') %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if _icon.name is defined and _icon.name is not empty %}
  {% set _icons = [_icon] %}
{% elseif _icon[1] is defined and _icon[1] is not empty %}
  {% set _icons = _icon %}
{% endif %}

{% if _hide_label and _icon is not empty %}
  {% set _css_class = _css_class ~ ' ecl-button--icon-only' %}
{% endif %}

{# Add disabled option if defined #}

{% if _disabled %}
  {% set _extra_attributes = _extra_attributes ~ ' disabled' %}
{% endif %}

{# Define icon macro #}

{% macro icon(_icons, _indicator, _indicator_content) %}{% apply spaceless %}
  {% import _self as button %}

  {% for icon in _icons %}
    {% set _icon_extra_classes = 'ecl-button__icon' %}
    {%- if icon.extra_classes is defined and icon.extra_classes is not empty -%}
      {% set _icon_extra_classes = _icon_extra_classes ~ ' ' ~ icon.extra_classes %}
    {%- endif -%}
    {% set _icon_extra_accessibility = {} %}
    {% set _icon_image = false %}
    {%- if icon.title is not empty -%}
      {% set _icon_extra_accessibility = { title: icon.title } %}
      {% set _icon_image = true %}
    {%- endif -%}

    {% if _indicator is not empty %}
      <span class="ecl-button__icon-container">
        {% include '@ecl/icon/icon.html.twig' with {
          icon: icon,
          as_image: _icon_image,
          extra_accessibility: _icon_extra_accessibility,
          extra_classes: _icon_extra_classes,
          extra_attributes: [
            { name: 'data-ecl-icon' }
          ],
        } only %}
        {% include '@ecl/indicator/indicator.html.twig' with _indicator only %}
      </span>
    {% else %}
      {% include '@ecl/icon/icon.html.twig' with {
        icon: icon,
        as_image: _icon_image,
        extra_accessibility: _icon_extra_accessibility,
        extra_classes: _icon_extra_classes,
        extra_attributes: [
          { name: 'data-ecl-icon' }
        ],
      } only %}
    {% endif %}    
  {% endfor %}

{% endapply %}{% endmacro %}

{# Print the result #}

<button
  class="{{ _css_class }}"
  type="{{ _type }}"
  {{ _extra_attributes|raw }}
>
{%- if _icons is defined %}
  <span class="ecl-button__container">
  {% if _icon_position == 'before' %}
    {{ button.icon(_icons, _indicator, _indicator_content) }}
  {% endif %}
  {% if _label %}
    <span class="ecl-button__label" data-ecl-label="true">{% block label _label %}</span>
  {% endif %}
  {% if _icon_position == 'after' %}
    {{ button.icon(_icons, _indicator, _indicator_content) }}
  {% endif %}
  </span>
{% else %}
  {{- block('label') -}}
{% endif -%}
</button>

{% endapply %}
